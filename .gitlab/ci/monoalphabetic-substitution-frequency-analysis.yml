monoalphabetic-substitution-frequency-analysis-formatting:
  stage: formatting
  image: rust
  before_script:
    - wget -q -O tmp.zip "https://gitlab.com/DeveloperC/is_effected/-/jobs/artifacts/0.4.1/download?job=release-binary-compiling-x86_64-linux-musl" && unzip tmp.zip && rm tmp.zip
    - is_effected="$(pwd)/is_effected"
    - rustup component add rustfmt
  script:
    - cd monoalphabetic-substitution-cipher/frequency-analysis
    # Check the monorepo is effected in the merge request or else skip the stage.
    - ${is_effected} --from-reference "origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME" --effects-current-directory || exit 0
    - cargo fmt --all -- --check --config=group_imports=StdExternalCrate
  rules:
    - if: $CI_MERGE_REQUEST_ID


monoalphabetic-substitution-frequency-analysis-linting:
  stage: linting
  image: rust
  before_script:
    - wget -q -O tmp.zip "https://gitlab.com/DeveloperC/is_effected/-/jobs/artifacts/0.4.1/download?job=release-binary-compiling-x86_64-linux-musl" && unzip tmp.zip && rm tmp.zip
    - is_effected="$(pwd)/is_effected"
    - rustup component add clippy
  script:
    - cd monoalphabetic-substitution-cipher/frequency-analysis
    # Check the monorepo is effected in the merge request or else skip the stage.
    - ${is_effected} --from-reference "origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME" --effects-current-directory || exit 0
    - cargo clippy --verbose --workspace --all-targets -- -D warnings
    - cargo clippy --verbose --workspace --all-targets --all-features -- -D warnings
    - cargo clippy --verbose --workspace --all-targets --no-default-features -- -D warnings
  rules:
    - if: $CI_MERGE_REQUEST_ID


monoalphabetic-substitution-frequency-analysis-version-badge-checking:
  stage: version-badge-checking
  image: alpine
  before_script:
    - wget -q -O tmp.zip "https://gitlab.com/DeveloperC/is_effected/-/jobs/artifacts/0.4.1/download?job=release-binary-compiling-x86_64-linux-musl" && unzip tmp.zip && rm tmp.zip
    - is_effected="$(pwd)/is_effected"
  script:
    - cd monoalphabetic-substitution-cipher/frequency-analysis
    # Check the monorepo is effected in the merge request or else skip the stage.
    - ${is_effected} --from-reference "origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME" --effects-current-directory || exit 0
    # Get current version.
    - current_version=$(grep "^version = \"${SEMANTIC_VERSIONING_REGEX}\"$" "Cargo.toml" | cut -d '"' -f 2)
    # Check README version badge and version match.
    - grep -q "(https://img.shields.io/badge/Version-${current_version}-blue)]" "README.md"
  rules:
    - if: $CI_MERGE_REQUEST_ID


monoalphabetic-substitution-frequency-analysis-compiling:
  stage: compiling
  image: rust
  before_script:
    - wget -q -O tmp.zip "https://gitlab.com/DeveloperC/is_effected/-/jobs/artifacts/0.4.1/download?job=release-binary-compiling-x86_64-linux-musl" && unzip tmp.zip && rm tmp.zip
    - is_effected="$(pwd)/is_effected"
  script:
    - cd monoalphabetic-substitution-cipher/frequency-analysis
    # Check the monorepo is effected in the merge request or else skip the stage.
    - ${is_effected} --from-reference "origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME" --effects-current-directory || exit 0
    - cargo build --verbose --workspace
    - cargo build --verbose --workspace --all-features
    - cargo build --verbose --workspace --no-default-features
  rules:
    - if: $CI_MERGE_REQUEST_ID
    - if: $CI_COMMIT_BRANCH == "master"


monoalphabetic-substitution-frequency-analysis-unit-testing:
  stage: unit-testing
  image: rust
  before_script:
    - wget -q -O tmp.zip "https://gitlab.com/DeveloperC/is_effected/-/jobs/artifacts/0.4.1/download?job=release-binary-compiling-x86_64-linux-musl" && unzip tmp.zip && rm tmp.zip
    - is_effected="$(pwd)/is_effected"
  script:
    - cd monoalphabetic-substitution-cipher/frequency-analysis
    # Check the monorepo is effected in the merge request or else skip the stage.
    - ${is_effected} --from-reference "origin/$CI_MERGE_REQUEST_TARGET_BRANCH_NAME" --effects-current-directory || exit 0
    - cargo test --verbose --workspace
    - cargo test --verbose --workspace --all-features
    - cargo test --verbose --workspace --no-default-features
  rules:
    - if: $CI_MERGE_REQUEST_ID
    - if: $CI_COMMIT_BRANCH == "master"
